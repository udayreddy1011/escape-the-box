<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, user-scalable=no" />

  <title>Escape the Box</title>

  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#000000">

  <style>
    body {
      margin: 0;
      background: #111;
      color: white;
      font-family: Arial;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      overflow: hidden;
      touch-action: none;
    }

    #game {
      position: relative;
      width: 320px;
      height: 480px;
      background: #222;
      border: 2px solid white;
      overflow: hidden;
    }

    .player {
      width: 30px;
      height: 30px;
      background: lime;
      position: absolute;
      border-radius: 6px;
    }

    .enemy {
      width: 28px;
      height: 28px;
      background: red;
      position: absolute;
      border-radius: 6px;
    }

    #controls {
      display: grid;
      grid-template-columns: 70px 70px 70px;
      gap: 10px;
      margin-top: 10px;
    }

    .btn {
      width: 70px;
      height: 70px;
      background: #333;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      user-select: none;
    }
  </style>
</head>

<body>

<h3>Escape the Box</h3>

<div id="game">
  <div id="player" class="player"></div>
</div>

<!-- D-Pad -->
<div id="controls">
  <div></div>
  <div class="btn" id="up">⬆️</div>
  <div></div>

  <div class="btn" id="left">⬅️</div>
  <div class="btn" id="down">⬇️</div>
  <div class="btn" id="right">➡️</div>
</div>

<script>
  const game = document.getElementById("game");
  const player = document.getElementById("player");

  const gameWidth = 320;
  const gameHeight = 480;

  let px = 145;
  let py = 220;

  const speed = 6;
  let enemies = [];
  let gameOver = false;

  player.style.left = px + "px";
  player.style.top = py + "px";

  /* ---------- PLAYER MOVEMENT ---------- */

  function move(dx, dy) {
    px = Math.max(0, Math.min(gameWidth - 30, px + dx));
    py = Math.max(0, Math.min(gameHeight - 30, py + dy));
    player.style.left = px + "px";
    player.style.top = py + "px";
  }

  // keyboard
  document.addEventListener("keydown", e => {
    if (e.key === "ArrowUp") move(0, -speed);
    if (e.key === "ArrowDown") move(0, speed);
    if (e.key === "ArrowLeft") move(-speed, 0);
    if (e.key === "ArrowRight") move(speed, 0);
  });

  // touch buttons
  document.getElementById("up").ontouchstart = () => move(0, -speed);
  document.getElementById("down").ontouchstart = () => move(0, speed);
  document.getElementById("left").ontouchstart = () => move(-speed, 0);
  document.getElementById("right").ontouchstart = () => move(speed, 0);

  /* ---------- ENEMY SPAWN ---------- */

  function spawnEnemy() {
    const enemy = document.createElement("div");
    enemy.className = "enemy";

    const side = Math.floor(Math.random() * 4);

    let x, y, vx, vy;

    if (side === 0) { // top
      x = Math.random() * 290;
      y = -30;
      vx = 0;
      vy = 2;
    } else if (side === 1) { // bottom
      x = Math.random() * 290;
      y = gameHeight + 30;
      vx = 0;
      vy = -2;
    } else if (side === 2) { // left
      x = -30;
      y = Math.random() * 450;
      vx = 2;
      vy = 0;
    } else { // right
      x = gameWidth + 30;
      y = Math.random() * 450;
      vx = -2;
      vy = 0;
    }

    enemy.style.left = x + "px";
    enemy.style.top = y + "px";

    game.appendChild(enemy);

    enemies.push({ el: enemy, x, y, vx, vy });
  }

  setInterval(spawnEnemy, 5000);
  spawnEnemy();

  /* ---------- GAME LOOP ---------- */

  function loop() {
    if (gameOver) return;

    enemies.forEach((e, i) => {
      e.x += e.vx;
      e.y += e.vy;

      e.el.style.left = e.x + "px";
      e.el.style.top = e.y + "px";

      // collision
      if (
        Math.abs(e.x - px) < 25 &&
        Math.abs(e.y - py) < 25
      ) {
        alert("Game Over");
        gameOver = true;
        return;
      }
    });

    requestAnimationFrame(loop);
  }

  requestAnimationFrame(loop);

  /* ---------- PWA ---------- */
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("./service-worker.js");
  }
</script>

</body>
</html>
